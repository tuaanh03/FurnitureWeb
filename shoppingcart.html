<!DOCTYPE html>
<html lang="en">

<head>
    <title>VAT Furniture Shop </title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="apple-touch-icon" href="assets/img/vaticon.png">
    <link rel="shortcut icon" type="image/x-icon" href="assets/img/favicone.png">

    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/templatemo.css">
    <link rel="stylesheet" href="assets/css/custom.css">

    <!-- Load fonts style after rendering the layout styles -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;700;900&display=swap">
    <link rel="stylesheet" href="assets/css/fontawesome.min.css">
    <link rel="stylesheet" href="assets/icon/themify-icons/themify-icons.css">
    <link rel="stylesheet" href="assets/css/modal-login.css">
</head>

<body>
    <!-- Start Top Nav -->
    <nav class="navbar navbar-expand-lg bg-dark navbar-light d-none d-lg-block" id="templatemo_nav_top">
        <div class="container text-light">
            <div class="w-100 d-flex justify-content-between">
                <div>
                    <i class="fa fa-envelope mx-2"></i>
                    <a class="navbar-sm-brand text-light text-decoration-none" href="mailto:info@company.com">info@company.com</a>
                    <i class="fa fa-phone mx-2"></i>
                    <a class="navbar-sm-brand text-light text-decoration-none" href="tel:010-020-0340">010-020-0340</a>
                </div>
                <div>
                    <a class="text-light" href="https://fb.com/templatemo" target="_blank" rel="sponsored"><i class="fab fa-facebook-f fa-sm fa-fw me-2"></i></a>
                    <a class="text-light" href="https://www.instagram.com/" target="_blank"><i class="fab fa-instagram fa-sm fa-fw me-2"></i></a>
                    <a class="text-light" href="https://twitter.com/" target="_blank"><i class="fab fa-twitter fa-sm fa-fw me-2"></i></a>
                    <a class="text-light" href="https://www.linkedin.com/" target="_blank"><i class="fab fa-linkedin fa-sm fa-fw"></i></a>
                </div>
            </div>
        </div>
    </nav>
    <!-- Close Top Nav -->


    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-light shadow">
        <div class="container d-flex justify-content-between align-items-center">

            <a class="navbar-brand text-success logo h1 align-self-center" href="index.html" style="text-align: center;">
                <img src="assets/img/vaticon.png" alt="" style="width: 30%">
                <h1 style="font-size: 20px;">Vũ Anh Toàn </h1>
                <!-- VAT -->
            </a>

            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#templatemo_main_nav" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="align-self-center collapse navbar-collapse flex-fill  d-lg-flex justify-content-lg-between" id="templatemo_main_nav">
                <div class="flex-fill">
                    <ul class="nav navbar-nav d-flex justify-content-between mx-lg-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">Trang chủ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="about.html">Về chúng tôi</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="shop.html">Sản phẩm</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="contact.html">Liên hệ</a>
                        </li>
                    </ul>
                </div>
                <div class="navbar align-self-center d-flex">
                    <div class="d-lg-none flex-sm-fill mt-3 mb-4 col-7 col-sm-auto pr-3">
                        <div class="input-group">
                            <input type="text" class="form-control" id="inputMobileSearch" placeholder="Search ...">
                            <div class="input-group-text">
                                <i class="fa fa-fw fa-search"></i>
                            </div>
                        </div>
                    </div>
                    <a class="nav-icon d-none d-lg-inline" href="#">
                        <i class="fa fa-fw fa-search text-dark mr-2"></i>
                    </a>
                    <a class="nav-icon position-relative text-decoration-none" onclick="directCart();">
                        <i class="fa fa-fw fa-cart-arrow-down text-dark mr-1"></i>
                        <span class="position-absolute top-0 left-100 translate-middle badge rounded-pill bg-light text-dark" id="cartNo">0</span>
                    </a>
                    <a class="nav-icon position-relative text-decoration-none" >
                        <i id="userIcon" class="fa fa-fw fa-user text-dark mr-3"></i>
                        <span id="loggedInUserName" class="position-absolute top-0 left-100 translate-middle badge rounded-pill bg-light text-dark"></span>
                        <ul class="sub-menu" id="subMenu">
                            <li id="userInfoLink" onclick="userinfo()" >Thông tin</li>
                            <li id="purchaseHistoryLink" onclick="historypurchase()">Lịch sử mua hàng</li>
                            <li id="loginLink" onclick="login()">Đăng nhập</li>
                            <li id="registerLink" onclick="register()">Đăng ký</li>
                            <li id="logoutLink" onclick="logout()">Đăng xuất</li>
                        </ul>
                    </a>
                </div>
            </div>

        </div>
    </nav>
    <!-- Close Header -->

    <!-- Start Content -->
    <div class="content">
        <div class="inner">
            <table id="tblcart" border="0" style="width: 90%;">

            </table>

            <div id="totalMoney">

            </div>
            <button id ="checkout-button" onclick="redirectToPayPage()">Thanh toán</button>

            <div id="emptyCardmessage" style="display: none;">
                <p style="text-align: center; padding: 50px;">Không có sản phẩm nào trong giỏ hàng của bạn.</p>
            </div>

        </div>
    </div>
    <!-- Close Content -->

    <!-- Start Footer -->
    <footer class="bg-dark" id="tempaltemo_footer">
        <div class="container">
            <div class="row">

                <div class="col-md-4 pt-5">
                    <h2 class="h2 text-success border-bottom pb-3 border-light logo">VAT Shop</h2>
                    <ul class="list-unstyled text-light footer-link-list">
                        <li>
                            <i class="fas fa-map-marker-alt fa-fw"></i>
                            273 Đ. An Dương Vương, Phường 3, Quận 5, Thành phố Hồ Chí Minh
                        </li>
                        <li>
                            <i class="fa fa-phone fa-fw"></i>
                            <a class="text-decoration-none" href="tel:010-020-0340">010-020-0340</a>
                        </li>
                        <li>
                            <i class="fa fa-envelope fa-fw"></i>
                            <a class="text-decoration-none" href="mailto:info@company.com">info@company.com</a>
                        </li>
                    </ul>
                </div>

                <div class="col-md-4 pt-5">
                    <h2 class="h2 text-light border-bottom pb-3 border-light">Sản phẩm</h2>
                    <ul class="list-unstyled text-light footer-link-list">
                        <li><a class="text-decoration-none" href="#">Cao cấp</a></li>
                        <li><a class="text-decoration-none" href="#">Bộ bàn ghế</a></li>
                        <li><a class="text-decoration-none" href="#">Giường</a></li>
                        <li><a class="text-decoration-none" href="#">Poufs</a></li>
                        <li><a class="text-decoration-none" href="#">Sofas</a></li>
                        <li><a class="text-decoration-none" href="#">Kệ - tủ sách</a></li>
                        <li><a class="text-decoration-none" href="#">Phụ kiện khác</a></li>
                    </ul>
                </div>

                <div class="col-md-4 pt-5">
                    <h2 class="h2 text-light border-bottom pb-3 border-light">Thông tin chi tiết</h2>
                    <ul class="list-unstyled text-light footer-link-list">
                        <li><a class="text-decoration-none" href="#">Trang chủ</a></li>
                        <li><a class="text-decoration-none" href="#">Về chúng tôi</a></li>
                        <li><a class="text-decoration-none" href="#">Địa chỉ cửa hàng</a></li>
                        <li><a class="text-decoration-none" href="#">FAQs</a></li>
                        <li><a class="text-decoration-none" href="#">Liên hệ</a></li>
                    </ul>
                </div>

            </div>

            <div class="row text-light mb-4">
                <div class="col-12 mb-3">
                    <div class="w-100 my-3 border-top border-light"></div>
                </div>
                <div class="col-auto me-auto">
                    <ul class="list-inline text-left footer-icons">
                        <li class="list-inline-item border border-light rounded-circle text-center">
                            <a class="text-light text-decoration-none" target="_blank" href="http://facebook.com/"><i class="fab fa-facebook-f fa-lg fa-fw"></i></a>
                        </li>
                        <li class="list-inline-item border border-light rounded-circle text-center">
                            <a class="text-light text-decoration-none" target="_blank" href="https://www.instagram.com/"><i class="fab fa-instagram fa-lg fa-fw"></i></a>
                        </li>
                        <li class="list-inline-item border border-light rounded-circle text-center">
                            <a class="text-light text-decoration-none" target="_blank" href="https://twitter.com/"><i class="fab fa-twitter fa-lg fa-fw"></i></a>
                        </li>
                        <li class="list-inline-item border border-light rounded-circle text-center">
                            <a class="text-light text-decoration-none" target="_blank" href="https://www.linkedin.com/"><i class="fab fa-linkedin fa-lg fa-fw"></i></a>
                        </li>
                    </ul>
                </div>
                <div class="col-auto">
                    <label class="sr-only" for="subscribeEmail">Email address</label>
                    <div class="input-group mb-2">
                        <input type="text" class="form-control bg-dark border-light" id="subscribeEmail" placeholder="Email address">
                        <div class="input-group-text btn-success text-light">Subscribe</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="w-100 bg-black py-3">
            <div class="container">
                <div class="row pt-2">
                    <div class="col-12">
                        <p class="text-left text-light">
                            Copyright &copy; 2023 Company Name
                            | Designed by <a rel="sponsored" href="#" target="_blank">VAT</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>

    </footer>
    <!-- End Footer -->

    <!-- Start Script -->
    <script src="/LoginForm/js/logincheck.js"></script>
    <script src="/LoginForm/js/main.js"></script>
    <script src="/LoginForm/js/test.js"></script>
    <script src="assets/js/jquery-1.11.0.min.js"></script>
    <script src="assets/js/jquery-migrate-1.2.1.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/templatemo.js"></script>
    <script src="assets/js/custom.js"></script>

    <script>
        let arrCart = JSON.parse(localStorage.getItem("myCart")) || [];
        let quantityItem = localStorage.getItem("TotalQuantity") || 0;

        function updateCart() {
            let strheader = `<tr>
                                <th>Tên sản phẩm</th>
                                <th>Hình</th>
                                <th>Giá</th>
                                <th>Số lượng</th>
                                <th>Thành tiền</th>
                                <th></th>
                            </tr>`;
            let strData = "";
            let tong = 0;

            if (arrCart.length === 0 )
            {
                document.getElementById("emptyCardmessage").style.display = "block";
                document.getElementById("tblcart").style.display = "none";
                document.getElementById("totalMoney").style.display = "none";
                document.getElementById("checkout-button").style.display = "none";
            }
            else
            {
                document.getElementById("emptyCardmessage").style.display = "none";
                document.getElementById("checkout-button").style.display = "block";
                arrCart.forEach(item => {
                strData += `<tr>
                               <td>
    <input style="" type="checkbox" class="product-checkbox"
        value="${item.sp.ten}"
        data-product-name="${item.sp.ten}"
        data-product-price="${item.sp.gia}"
        data-product-quantity="${item.soluong}">
    ${item.sp.ten}
</td>
<td>
                                    <img src="./assets/img/itemlist/${item.sp.hinh[0]}" width="50px" height="50px" >
                                </td>
                                <td>${item.sp.gia}</td>
                                <td>
                                    <li class="list-inline-item" style="margin-right: 0;">
                                        <span class="btn btn-success" onclick="decrement(${arrCart.indexOf(item)})">-</span>
                                    </li>
                                    <li class="list-inline-item" style="margin-right: 0">
                                        <span class="badge bg-secondary" id="var-value">${item.soluong}</span>
                                    </li>
                                    <li class="list-inline-item">
                                        <span class="btn btn-success" onclick="increment(${arrCart.indexOf(item)})">+</span>
                                    </li>
                                </td>
                                <td>${item.sp.gia * item.soluong}</td>
                                <td>
                                    <button onclick="removeItem(${arrCart.indexOf(item)}); alert('Bạn có chắc chắn muốn xóa ?')">Xóa</button>
                                </td>

                            </tr>`;

                tong += item.sp.gia * item.soluong;
            });
            document.querySelector("#tblcart").innerHTML = strheader + strData;
            let strtotal =
            `
            <h2>Tổng cộng:  ${tong}<sup>đ</sup></h2>
            `;

            document.querySelector("#totalMoney").innerHTML = strtotal;
            }


            // document.querySelector("#totalMoney").innerHTML = tong;
            document.querySelector("#cartNo").innerText = quantityItem;

            // Update the local storage
            localStorage.setItem("TotalQuantity", quantityItem + "");
            localStorage.setItem("myCart", JSON.stringify(arrCart));


        }

        function increment(index) {
            arrCart[index].soluong++;
            quantityItem++;
            updateCart();
        }

        function decrement(index) {
            if (arrCart[index].soluong > 1) {
                arrCart[index].soluong--;
                quantityItem--;
                updateCart();
            }
        }

        function removeItem(index) {
            quantityItem -= arrCart[index].soluong;
            arrCart.splice(index, 1);
            updateCart();
        }

        updateCart(); // Call the function to initialize the cart on page load
    </script>

    <script>
        function directCart()
            {
                location.href = "shoppingcart.html";
            }
    </script>
    <script>
        function redirectToPayPage() {
            var username = localStorage.getItem('loggedInUser');
            if (!username) {
                alert('Vui lòng đăng nhập trước khi mua hàng.');
                window.location.href = 'login.html';
                return;
            }
            // Lấy tất cả các checkbox sản phẩm đã chọn
            const checkboxes = document.querySelectorAll('.product-checkbox:checked');

            // Tạo một mảng để lưu trữ thông tin các sản phẩm đã chọn
            const selectedProducts = [];

            // Lặp qua tất cả các checkbox
            checkboxes.forEach(checkbox => {
                // Lấy thông tin từ dataset của checkbox
                const productName = checkbox.dataset.productName;
                const productPrice = checkbox.dataset.productPrice;
                const productQuantity = checkbox.dataset.productQuantity;

                // Tạo một đối tượng để lưu thông tin sản phẩm
                const product = {
                    name: productName,
                    price: productPrice,
                    quantity: productQuantity
                };

                // Thêm sản phẩm vào mảng
                selectedProducts.push(product);
            });

            // Lưu thông tin vào Local Storage
            localStorage.setItem('selectedProducts', JSON.stringify(selectedProducts));

            // Chuyển hướng đến trang pay.html
            window.location.href = 'pay.html';
        }

    </script>

    <!-- End Script -->



</body>

</html>